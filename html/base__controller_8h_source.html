<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My diffbot project: diffbot_base/scripts/base_controller/lib/base_controller/base_controller.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My diffbot project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_7871d1056cf438567bdd2b3b4212868c.html">diffbot_base</a></li><li class="navelem"><a class="el" href="dir_12140ba13f3b9dfe244de78a75bf9d3b.html">scripts</a></li><li class="navelem"><a class="el" href="dir_d43b7fcc903dcaa0a0cb076c32fc56df.html">base_controller</a></li><li class="navelem"><a class="el" href="dir_66e090e3ebe9b73f5462c92569ae45c4.html">lib</a></li><li class="navelem"><a class="el" href="dir_5af22d1b47f308b9ff5fb6a2afe804f8.html">base_controller</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">base_controller.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="base__controller_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Author: Franz Pucher</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#ifndef DIFFBOT_BASE_CONTROLLER_H</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#define DIFFBOT_BASE_CONTROLLER_H</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;ros.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="EncodersStamped_8h.html">diffbot_msgs/EncodersStamped.h</a>&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="WheelsCmdStamped_8h.html">diffbot_msgs/WheelsCmdStamped.h</a>&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AngularVelocities_8h.html">diffbot_msgs/AngularVelocities.h</a>&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="PIDStamped_8h.html">diffbot_msgs/PIDStamped.h</a>&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;std_msgs/Empty.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;sensor_msgs/JointState.h&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="diffbot__base__config_8h.html">diffbot_base_config.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="encoder__diffbot_8h.html">encoder_diffbot.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="adafruit__feather__wing_8h.html">adafruit_feather_wing/adafruit_feather_wing.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;pid.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="namespacediffbot.html">   23</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacediffbot.html">diffbot</a> {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html">   77</a></span>&#160;    <span class="keyword">class </span><a class="code" href="classdiffbot_1_1BaseController.html">BaseController</a></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <a class="code" href="classdiffbot_1_1BaseController.html#a4c57157c3165940f194e85be6aea09a9">BaseController</a>(ros::NodeHandle &amp;<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>, TMotorController* <a class="code" href="main_8cpp.html#a4f09664c28604c52bef0b6974e62d1a9">motor_controller_left</a>, TMotorController* <a class="code" href="main_8cpp.html#ac36c3751c4beb4c6f24b01eb38332bd8">motor_controller_right</a>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html">  103</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html">UpdateRate</a></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        {</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ad2078bf4193de947e61bb461845065ba">  105</a></span>&#160;            <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ad2078bf4193de947e61bb461845065ba">imu_</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a30323dd51be901ca398e2de5f3cec717">  106</a></span>&#160;            <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a30323dd51be901ca398e2de5f3cec717">control_</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac039904aa4bbdb3aaf33277bf4877b82">  107</a></span>&#160;            <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac039904aa4bbdb3aaf33277bf4877b82">debug_</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html">  114</a></span>&#160;            <span class="keyword">struct </span><a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html">Period</a></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            {</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a126adae7a39d5a8f4b1bc52232832da6">  116</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a126adae7a39d5a8f4b1bc52232832da6">imu_</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a8a64d2fe88a5f6c955f2a48f4786106e">  117</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a8a64d2fe88a5f6c955f2a48f4786106e">control_</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a41d2ff3999de2b4eb2f2c944d204e80c">  118</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a41d2ff3999de2b4eb2f2c944d204e80c">debug_</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a4cf807484d0d55818d3fdd798456741b">  120</a></span>&#160;                <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a4cf807484d0d55818d3fdd798456741b">Period</a>(<span class="keywordtype">double</span> imu_frequency, <span class="keywordtype">double</span> control_frequency, <span class="keywordtype">double</span> debug_frequency)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    : <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a126adae7a39d5a8f4b1bc52232832da6">imu_</a>(1.0 / imu_frequency)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    , <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a8a64d2fe88a5f6c955f2a48f4786106e">control_</a>(1.0 / control_frequency)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    , <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a41d2ff3999de2b4eb2f2c944d204e80c">debug_</a>(1.0 / debug_frequency) {};</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            } <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a693ab4729a3c580f79368f9d1d28b37e">period_</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a096966d88bdf8ee1b5d82b4a055765a3">  126</a></span>&#160;            <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html">Period</a>&amp; <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a096966d88bdf8ee1b5d82b4a055765a3">period</a>() { <span class="keywordflow">return</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a693ab4729a3c580f79368f9d1d28b37e">period_</a>; };</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac0ec145b57b867163cddab200b070576">  139</a></span>&#160;            <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac0ec145b57b867163cddab200b070576">UpdateRate</a>(<span class="keywordtype">double</span> imu_frequency,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                               <span class="keywordtype">double</span> control_frequency,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                               <span class="keywordtype">double</span> debug_frequency)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                : <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ad2078bf4193de947e61bb461845065ba">imu_</a>(imu_frequency)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a30323dd51be901ca398e2de5f3cec717">control_</a>(control_frequency)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac039904aa4bbdb3aaf33277bf4877b82">debug_</a>(debug_frequency)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a693ab4729a3c580f79368f9d1d28b37e">period_</a>(imu_frequency, control_frequency, debug_frequency) {};</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        } <a class="code" href="classdiffbot_1_1BaseController.html#a0dad88e3a39fd4a5cfa83eef522fa948">update_rate_</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#af5d5dfd7526ef090dfce4d2dbf716fcb">  154</a></span>&#160;        <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classdiffbot_1_1BaseController.html#af5d5dfd7526ef090dfce4d2dbf716fcb">period</a>(<span class="keywordtype">double</span> frequency) { <span class="keywordflow">return</span> 1 / frequency; };</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a963c3507de5449f9d4a8451a7a864e5b">  156</a></span>&#160;        <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1UpdateRate.html">UpdateRate</a>&amp; <a class="code" href="classdiffbot_1_1BaseController.html#a963c3507de5449f9d4a8451a7a864e5b">publishRate</a>() { <span class="keywordflow">return</span> <a class="code" href="classdiffbot_1_1BaseController.html#a0dad88e3a39fd4a5cfa83eef522fa948">update_rate_</a>; };</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html">  167</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html">LastUpdateTime</a></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="comment">// Time when the last angular wheel command velocity was received.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a315c93513da94a16a851685704014861">  170</a></span>&#160;            ros::Time <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a315c93513da94a16a851685704014861">command_received</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="comment">// Time when the last control update happened.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a16aa742c7b6e982e0919fa1631104047">  172</a></span>&#160;            ros::Time <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a16aa742c7b6e982e0919fa1631104047">control</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="comment">// Time when the last imu update took place.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#acf4ae0e5dc8af245bbec62161d71d7ba">  174</a></span>&#160;            ros::Time <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#acf4ae0e5dc8af245bbec62161d71d7ba">imu</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="comment">// Time when the last debug message was logged.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a7a8f48dde436f62fc40b6698a5bb0167">  176</a></span>&#160;            ros::Time <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a7a8f48dde436f62fc40b6698a5bb0167">debug</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#aaa05a5efb43e892c1bc1614344cce952">  186</a></span>&#160;            <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#aaa05a5efb43e892c1bc1614344cce952">LastUpdateTime</a>(ros::Time start)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                : <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a315c93513da94a16a851685704014861">command_received</a>(start.toSec(), start.toNsec())</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a16aa742c7b6e982e0919fa1631104047">control</a>(start.toSec(), start.toNsec())</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#acf4ae0e5dc8af245bbec62161d71d7ba">imu</a>(start.toSec(), start.toNsec())</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                , <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a7a8f48dde436f62fc40b6698a5bb0167">debug</a>(start.toSec(), start.toNsec()) {};</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        } <a class="code" href="classdiffbot_1_1BaseController.html#a1387b4e876fabe7bee2651f7bde4056e">last_update_time_</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a7dd1945472f83a891dc294daf76b4f47">  202</a></span>&#160;        <span class="keyword">inline</span> <a class="code" href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html">LastUpdateTime</a>&amp; <a class="code" href="classdiffbot_1_1BaseController.html#a7dd1945472f83a891dc294daf76b4f47">lastUpdateTime</a>() { <span class="keywordflow">return</span> <a class="code" href="classdiffbot_1_1BaseController.html#a1387b4e876fabe7bee2651f7bde4056e">last_update_time_</a>; };</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a396de065f1958ceada2110f266ad41d2">  211</a></span>&#160;        <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classdiffbot_1_1BaseController.html#a396de065f1958ceada2110f266ad41d2">debug</a>() { <span class="keywordflow">return</span> debug_; };</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a6c8407098d2de3bf7b5b2d8a97293203">setup</a>();</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a9add57ee869347d4ee2eeb4e733539fd">init</a>();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a41354b4d51fc8fb9c97aca6d0d14a446">eStop</a>();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#aac89c2d5c22bdabd9d697dad9a72babb">read</a>();</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a0d178440f5f9ca53ee9a07557db75ffd">write</a>();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a149626e3e16552903f8b53e5c37a0d86">printDebug</a>();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a23ae7d9ca0750e9b48b3b037556697a6">commandCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1WheelsCmdStamped.html">diffbot_msgs::WheelsCmdStamped</a>&amp; cmd_msg);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a9ee08db827f2d8b355ed5592bda44159">resetEncodersCallback</a>(<span class="keyword">const</span> std_msgs::Empty&amp; reset_msg);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a001efa473375bc84721d4a4becae6250">pidLeftCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1PIDStamped.html">diffbot_msgs::PIDStamped</a>&amp; pid_msg);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a4c68e722a31b072408c54be82f3c6157">pidRightCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1PIDStamped.html">diffbot_msgs::PIDStamped</a>&amp; pid_msg);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="comment">// Reference to global node handle from main.cpp</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        ros::NodeHandle&amp; nh_;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// constants</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordtype">float</span> wheel_radius_ = 0.0;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordtype">float</span> max_linear_velocity_ = 0.0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordtype">float</span> max_angular_velocity_ = 0.0;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="comment">// Encoder setup</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">// Change these pin numbers to the pins connected to your encoder.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">//   Best Performance: both pins have interrupt capability</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="comment">//   Good Performance: only the first pin has interrupt capability</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="comment">//   Low Performance:  neither pin has interrupt capability</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="comment">// avoid using pins with LEDs attached</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="code" href="classdiffbot_1_1Encoder.html">diffbot::Encoder</a> encoder_left_;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <a class="code" href="classdiffbot_1_1Encoder.html">diffbot::Encoder</a> encoder_right_;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordtype">long</span> ticks_left_ = 0, ticks_right_ = 0;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">// Measured left and right joint states (angular position (rad) and angular velocity (rad/s))</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="structdiffbot_1_1JointState.html">diffbot::JointState</a> joint_state_left_, joint_state_right_;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordtype">int</span> encoder_resolution_;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        ros::Subscriber&lt;std_msgs::Empty, BaseController&lt;TMotorController, TMotorDriver&gt;&gt; sub_reset_encoders_;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">// ROS Publisher setup to publish left and right encoder ticks</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment">// This uses the custom encoder ticks message that defines an array of two integers</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <a class="code" href="classdiffbot__msgs_1_1EncodersStamped.html">diffbot_msgs::EncodersStamped</a> encoder_msg_;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        ros::Publisher pub_encoders_;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        sensor_msgs::JointState msg_measured_joint_states_;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        ros::Publisher pub_measured_joint_states_;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <a class="code" href="classdiffbot_1_1MotorControllerIntf.html">MotorControllerIntf&lt;TMotorDriver&gt;</a>* p_motor_controller_right_;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="classdiffbot_1_1MotorControllerIntf.html">MotorControllerIntf&lt;TMotorDriver&gt;</a>* p_motor_controller_left_;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        ros::Subscriber&lt;diffbot_msgs::WheelsCmdStamped, BaseController&lt;TMotorController, TMotorDriver&gt;&gt; sub_wheel_cmd_velocities_;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordtype">float</span> wheel_cmd_velocity_left_ = 0.0;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordtype">float</span> wheel_cmd_velocity_right_ = 0.0;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordtype">int</span> motor_cmd_left_ = 0;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordtype">int</span> motor_cmd_right_ = 0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        ros::Subscriber&lt;diffbot_msgs::PIDStamped, BaseController&lt;TMotorController, TMotorDriver&gt;&gt; sub_pid_left_;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        ros::Subscriber&lt;diffbot_msgs::PIDStamped, BaseController&lt;TMotorController, TMotorDriver&gt;&gt; sub_pid_right_;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="classdiffbot_1_1PID.html">PID</a> motor_pid_left_;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="classdiffbot_1_1PID.html">PID</a> motor_pid_right_;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="comment">// DEBUG</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordtype">bool</span> debug_;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    };</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="base__controller_8h.html#a6802043505bd64fde9fb409e6eac3f44">  380</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classdiffbot_1_1BaseController.html">BC</a> = <a class="code" href="classdiffbot_1_1BaseController.html">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<a class="code" href="classdiffbot_1_1BaseController.html#a4c57157c3165940f194e85be6aea09a9">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;</a></div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a4c57157c3165940f194e85be6aea09a9">  385</a></span>&#160;<a class="code" href="classdiffbot_1_1BaseController.html#a4c57157c3165940f194e85be6aea09a9">    ::BaseController</a>(ros::NodeHandle &amp;<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>, TMotorController* <a class="code" href="main_8cpp.html#a4f09664c28604c52bef0b6974e62d1a9">motor_controller_left</a>, TMotorController* <a class="code" href="main_8cpp.html#ac36c3751c4beb4c6f24b01eb38332bd8">motor_controller_right</a>)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    : nh_(<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    , encoder_left_(<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>, <a class="code" href="diffbot__base__config_8h.html#a3148c286aedfd72fc73b730de3b7f8a6">ENCODER_LEFT_H1</a>, <a class="code" href="diffbot__base__config_8h.html#a4f7d31f06ff280776657b53c771dc402">ENCODER_LEFT_H2</a>, <a class="code" href="diffbot__base__config_8h.html#a8cdc17f43c9f3850f60d04f98216fc13">ENCODER_RESOLUTION</a>)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    , encoder_right_(<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>, <a class="code" href="diffbot__base__config_8h.html#ae560358977b6788dcbf345122f66a53f">ENCODER_RIGHT_H1</a>, <a class="code" href="diffbot__base__config_8h.html#a7462df31aa9a7ad3e49fd7e15736dad9">ENCODER_RIGHT_H2</a>, <a class="code" href="diffbot__base__config_8h.html#a8cdc17f43c9f3850f60d04f98216fc13">ENCODER_RESOLUTION</a>)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    , sub_reset_encoders_(<span class="stringliteral">&quot;reset&quot;</span>, &amp;<a class="code" href="classdiffbot_1_1BaseController.html">BC</a>&lt;TMotorController, TMotorDriver&gt;::resetEncodersCallback, this)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    , pub_encoders_(<span class="stringliteral">&quot;encoder_ticks&quot;</span>, &amp;encoder_msg_)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    , pub_measured_joint_states_(<span class="stringliteral">&quot;measured_joint_states&quot;</span>, &amp;msg_measured_joint_states_)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    , sub_wheel_cmd_velocities_(<span class="stringliteral">&quot;wheel_cmd_velocities&quot;</span>, &amp;<a class="code" href="classdiffbot_1_1BaseController.html">BC</a>&lt;TMotorController, TMotorDriver&gt;::commandCallback, this)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    , last_update_time_(<a class="code" href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a>.now())</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    , update_rate_(<a class="code" href="diffbot__base__config_8h.html#ad51b9b4efeff34df5fb421b536e0ca47">UPDATE_RATE_IMU</a>, <a class="code" href="diffbot__base__config_8h.html#aa54bf325fba5e78de32d34568279bce7">UPDATE_RATE_CONTROL</a>, <a class="code" href="diffbot__base__config_8h.html#ab9e2ca73fb264cfb39a4790b614ba4cf">UPDATE_RATE_DEBUG</a>)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    , sub_pid_left_(<span class="stringliteral">&quot;pid_left&quot;</span>, &amp;<a class="code" href="classdiffbot_1_1BaseController.html">BC</a>&lt;TMotorController, TMotorDriver&gt;::pidLeftCallback, this)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    , sub_pid_right_(<span class="stringliteral">&quot;pid_right&quot;</span>, &amp;<a class="code" href="classdiffbot_1_1BaseController.html">BC</a>&lt;TMotorController, TMotorDriver&gt;::pidRightCallback, this)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    , motor_pid_left_(PWM_MIN, <a class="code" href="diffbot__base__config_8h.html#a391fa1e490bd712720989b58fa0d9904">PWM_MAX</a>, <a class="code" href="diffbot__base__config_8h.html#acfc98b8c69707c30ac9a96bb12f2a0ab">K_P</a>, <a class="code" href="diffbot__base__config_8h.html#a5e606c8dc6de900bea3cd7740ac1bd4d">K_I</a>, <a class="code" href="diffbot__base__config_8h.html#a0b9e481775b5a7ecdd0dbb43cacc1a09">K_D</a>)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    , motor_pid_right_(PWM_MIN, <a class="code" href="diffbot__base__config_8h.html#a391fa1e490bd712720989b58fa0d9904">PWM_MAX</a>, <a class="code" href="diffbot__base__config_8h.html#acfc98b8c69707c30ac9a96bb12f2a0ab">K_P</a>, <a class="code" href="diffbot__base__config_8h.html#a5e606c8dc6de900bea3cd7740ac1bd4d">K_I</a>, <a class="code" href="diffbot__base__config_8h.html#a0b9e481775b5a7ecdd0dbb43cacc1a09">K_D</a>)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    p_motor_controller_left_ = <a class="code" href="main_8cpp.html#a4f09664c28604c52bef0b6974e62d1a9">motor_controller_left</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    p_motor_controller_right_ = <a class="code" href="main_8cpp.html#ac36c3751c4beb4c6f24b01eb38332bd8">motor_controller_right</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00406"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a6c8407098d2de3bf7b5b2d8a97293203">  406</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a6c8407098d2de3bf7b5b2d8a97293203">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::setup</a>()</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;{</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    nh_.initNode();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    nh_.advertise(pub_encoders_);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// msg_measured_joint_states_ is of type sensor_msgs::JointState</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// which contains float[] joint arrays of undefined size.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// For rosserial to work it is required to reserve the memory using malloc</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// and setting the *_length member appropriately.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="comment">// http://wiki.ros.org/rosserial/Overview/Limitations#Arrays</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    msg_measured_joint_states_.position = (<span class="keywordtype">float</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 2);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    msg_measured_joint_states_.position_length = 2;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    msg_measured_joint_states_.velocity = (<span class="keywordtype">float</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 2);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    msg_measured_joint_states_.velocity_length = 2;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    nh_.advertise(pub_measured_joint_states_);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    nh_.subscribe(sub_wheel_cmd_velocities_);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    nh_.subscribe(sub_reset_encoders_);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    nh_.subscribe(sub_pid_left_);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    nh_.subscribe(sub_pid_right_);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">while</span> (!nh_.connected())</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        nh_.spinOnce();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a9add57ee869347d4ee2eeb4e733539fd">  435</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a9add57ee869347d4ee2eeb4e733539fd">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::init</a>()</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    nh_.loginfo(<span class="stringliteral">&quot;Get Parameters from Parameter Server&quot;</span>);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    nh_.getParam(<span class="stringliteral">&quot;/diffbot/encoder_resolution&quot;</span>, &amp;this-&gt;encoder_resolution_);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    String log_msg = String(<span class="stringliteral">&quot;/diffbot/encoder_resolution: &quot;</span>) + String(encoder_resolution_);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    nh_.loginfo(log_msg.c_str());</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    nh_.getParam(<span class="stringliteral">&quot;/diffbot/mobile_base_controller/wheel_radius&quot;</span>, &amp;wheel_radius_);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    log_msg = String(<span class="stringliteral">&quot;/diffbot/mobile_base_controller/wheel_radius: &quot;</span>) + String(wheel_radius_);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    nh_.loginfo(log_msg.c_str());</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    nh_.getParam(<span class="stringliteral">&quot;/diffbot/mobile_base_controller/linear/x/max_velocity&quot;</span>, &amp;max_linear_velocity_);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    log_msg = String(<span class="stringliteral">&quot;/diffbot/mobile_base_controller/linear/x/max_velocity: &quot;</span>) + String(max_linear_velocity_);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    nh_.loginfo(log_msg.c_str());</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    nh_.getParam(<span class="stringliteral">&quot;/diffbot/debug/base_controller&quot;</span>, &amp;debug_);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    log_msg = String(<span class="stringliteral">&quot;/diffbot/debug/base_controller: &quot;</span>) + String(debug_);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    nh_.loginfo(log_msg.c_str());</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    nh_.loginfo(<span class="stringliteral">&quot;Initialize DiffBot Wheel Encoders&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    encoder_left_.resolution(encoder_resolution_);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    encoder_right_.resolution(encoder_resolution_);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    std_msgs::Empty reset;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    this-&gt;resetEncodersCallback(reset);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    delay(1);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    max_angular_velocity_ = max_linear_velocity_ / wheel_radius_;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    delay(1000);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a23ae7d9ca0750e9b48b3b037556697a6">  465</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a23ae7d9ca0750e9b48b3b037556697a6">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::commandCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1WheelsCmdStamped.html">diffbot_msgs::WheelsCmdStamped</a>&amp; cmd_msg)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;{</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// Callback function every time the angular wheel commands for each wheel joint are received from &#39;wheel_cmd_velocities&#39; topic</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// This callback function receives diffbot_msgs::WheelsCmdStamped message object</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// where diffbot_msgs::AngularVelocities for both joints are stored</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    wheel_cmd_velocity_left_ = cmd_msg.<a class="code" href="classdiffbot__msgs_1_1WheelsCmdStamped.html#ab136dcb1d1fb273b9c80d87394bb67bc">wheels_cmd</a>.<a class="code" href="classdiffbot__msgs_1_1WheelsCmd.html#ac9126a9abe092db908d1987f6ae0b11b">angular_velocities</a>.<a class="code" href="classdiffbot__msgs_1_1AngularVelocities.html#a8062f7bed2e6ad9a9ed1b7d0ee1fafe7">joint</a>[0];</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    wheel_cmd_velocity_right_ = cmd_msg.<a class="code" href="classdiffbot__msgs_1_1WheelsCmdStamped.html#ab136dcb1d1fb273b9c80d87394bb67bc">wheels_cmd</a>.<a class="code" href="classdiffbot__msgs_1_1WheelsCmd.html#ac9126a9abe092db908d1987f6ae0b11b">angular_velocities</a>.<a class="code" href="classdiffbot__msgs_1_1AngularVelocities.html#a8062f7bed2e6ad9a9ed1b7d0ee1fafe7">joint</a>[1];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// Used for the eStop. In case no diffbot_msgs::WheelsCmdStamped messages are received on the wheel_cmd_velocities </span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// topic, the eStop method is called (see main loop in main.cpp)</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    lastUpdateTime().command_received = nh_.now();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">// ROS Subscriber setup to reset both encoders to zero</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a9ee08db827f2d8b355ed5592bda44159">  480</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a9ee08db827f2d8b355ed5592bda44159">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::resetEncodersCallback</a>(<span class="keyword">const</span> std_msgs::Empty&amp; reset_msg)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;{</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">// reset both back to zero.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    this-&gt;encoder_left_.write(0);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    this-&gt;encoder_right_.write(0);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    this-&gt;nh_.loginfo(<span class="stringliteral">&quot;Reset both wheel encoders to zero&quot;</span>);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a001efa473375bc84721d4a4becae6250">  490</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a001efa473375bc84721d4a4becae6250">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::pidLeftCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1PIDStamped.html">diffbot_msgs::PIDStamped</a>&amp; pid_msg)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// Callback function to update the pid values of the left motor</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// This callback function receives diffbot_msgs::PID message object</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// where diffbot_msgs::PID kp, ki, kd for one pid controller is stored</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    motor_pid_left_.updateConstants(pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a909a4bf13dbfa8fa2617b247fac9ebaf">kp</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a9589054b637d533a252f0fcae026c3d1">ki</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a4aa5a80b7c77a1a412320e745b476b78">kd</a>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    motor_pid_left_.updateConstants(pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a909a4bf13dbfa8fa2617b247fac9ebaf">kp</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a9589054b637d533a252f0fcae026c3d1">ki</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a4aa5a80b7c77a1a412320e745b476b78">kd</a>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;}</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a4c68e722a31b072408c54be82f3c6157">  500</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a4c68e722a31b072408c54be82f3c6157">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::pidRightCallback</a>(<span class="keyword">const</span> <a class="code" href="classdiffbot__msgs_1_1PIDStamped.html">diffbot_msgs::PIDStamped</a>&amp; pid_msg)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Callback function to update the pid values of the left motor</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// This callback function receives diffbot_msgs::PID message object</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// where diffbot_msgs::PID kp, ki, kd for one pid controller is stored</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    motor_pid_left_.updateConstants(pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a909a4bf13dbfa8fa2617b247fac9ebaf">kp</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a9589054b637d533a252f0fcae026c3d1">ki</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a4aa5a80b7c77a1a412320e745b476b78">kd</a>);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    motor_pid_left_.updateConstants(pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a909a4bf13dbfa8fa2617b247fac9ebaf">kp</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a9589054b637d533a252f0fcae026c3d1">ki</a>, pid_msg.<a class="code" href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">pid</a>.<a class="code" href="classdiffbot__msgs_1_1PID.html#a4aa5a80b7c77a1a412320e745b476b78">kd</a>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#aac89c2d5c22bdabd9d697dad9a72babb">  511</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#aac89c2d5c22bdabd9d697dad9a72babb">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::read</a>()</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    joint_state_left_ = encoder_left_.jointState();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    joint_state_right_ = encoder_right_.jointState();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    msg_measured_joint_states_.position[0] = joint_state_left_.angular_position_;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    msg_measured_joint_states_.position[1] = joint_state_right_.angular_position_;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    msg_measured_joint_states_.velocity[0] = joint_state_left_.angular_velocity_;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    msg_measured_joint_states_.velocity[1] = joint_state_right_.angular_velocity_;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    pub_measured_joint_states_.publish(&amp;msg_measured_joint_states_);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// get the current tick count of each encoder</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    ticks_left_ = encoder_left_.read();</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    ticks_right_ = encoder_right_.read();</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    encoder_msg_.encoders.ticks[0] = ticks_left_;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    encoder_msg_.encoders.ticks[1] = ticks_right_;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// Avoid having too many publishers</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// Otherwise error like &#39;wrong checksum for topic id and msg&#39;</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// and &#39;Write timeout: Write timeout&#39; happen.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">//pub_encoders_.publish(&amp;encoder_msg_);</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;}</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a0d178440f5f9ca53ee9a07557db75ffd">  536</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a0d178440f5f9ca53ee9a07557db75ffd">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::write</a>()</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;{</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">// https://www.arduino.cc/reference/en/language/functions/math/map/</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// map(value, fromLow, fromHigh, toLow, toHigh)</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// Map angular wheel joint velocity to motor cmd</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// The /diffbot/mobile_base_controller/linear/x/max_velocity from the ROS parameter server </span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// is convert to max rotational velocity (see init()) and used to map the angular velocity to PWM signals for the motor.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// Note this is currently unused because the PID helps to keep the velocity to the commanded one.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">//motor_cmd_left_ = map(wheel_cmd_velocity_left_, -max_angular_velocity_, max_angular_velocity_, PWM_MIN, PWM_MAX);</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">//motor_cmd_right_ = map(wheel_cmd_velocity_right_, -max_angular_velocity_, max_angular_velocity_, PWM_MIN, PWM_MAX);</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// Compute PID output</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">// The value sent to the motor driver is calculated by the PID based on the error between commanded angular velocity vs measured angular velocity</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// The calculated PID ouput value is capped at -/+ MAX_RPM to prevent the PID from having too much error</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    motor_cmd_left_ = motor_pid_left_.compute(wheel_cmd_velocity_left_, joint_state_left_.angular_velocity_);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    motor_cmd_right_ = motor_pid_right_.compute(wheel_cmd_velocity_right_, joint_state_right_.angular_velocity_);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    p_motor_controller_left_-&gt;setSpeed(motor_cmd_left_);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    p_motor_controller_right_-&gt;setSpeed(motor_cmd_right_);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;}</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a41354b4d51fc8fb9c97aca6d0d14a446">  558</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a41354b4d51fc8fb9c97aca6d0d14a446">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::eStop</a>()</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;{</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    wheel_cmd_velocity_left_ = 0;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    wheel_cmd_velocity_right_ = 0;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> TMotorController, <span class="keyword">typename</span> TMotorDriver&gt;</div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="classdiffbot_1_1BaseController.html#a149626e3e16552903f8b53e5c37a0d86">  565</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdiffbot_1_1BaseController.html#a149626e3e16552903f8b53e5c37a0d86">diffbot::BaseController&lt;TMotorController, TMotorDriver&gt;::printDebug</a>()</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;{</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">    String log_msg =</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">            String(&quot;\nRead:\n&quot;) +</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">                String(&quot;ticks_left_ \t ticks_right_ \t measured_ang_vel_left \t measured_ang_vel_right\n&quot;) +</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">                String(ticks_left_) + String(&quot;\t&quot;) + String(ticks_right_) + String(&quot;\t&quot;) +</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">                String(joint_state_left_.angular_velocity_) + String(&quot;\t&quot;) + String(joint_state_right_.angular_velocity_) +</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">            String(&quot;\nWrite:\n&quot;) + </span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">                String(&quot;motor_cmd_left_ \t motor_cmd_right_ \t pid_left_error \t pid_right_error\n&quot;) +</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">                String(motor_cmd_left_) + String(&quot;\t&quot;) + String(motor_cmd_right_) + String(&quot;\t&quot;) +</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">                //String(&quot;pid_left \t pid_right\n&quot;) +</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">                String(motor_pid_left_.error()) + String(&quot;\t&quot;) + String(motor_pid_right_.error());</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    String log_msg =</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            String(<span class="stringliteral">&quot;\nRead:\n&quot;</span>) +</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                String(<span class="stringliteral">&quot;ticks_left_: &quot;</span>) + String(ticks_left_) +</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                String(<span class="stringliteral">&quot;\nticks_right_: &quot;</span>) + String(ticks_right_) +</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                String(<span class="stringliteral">&quot;\nmeasured_ang_vel_left: &quot;</span>) + String(joint_state_left_.angular_velocity_) +</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                String(<span class="stringliteral">&quot;\nmeasured_ang_vel_right: &quot;</span>) + String(joint_state_right_.angular_velocity_) +</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                String(<span class="stringliteral">&quot;\nwheel_cmd_velocity_left_: &quot;</span>) + String(wheel_cmd_velocity_left_) +</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                String(<span class="stringliteral">&quot;\nwheel_cmd_velocity_right_: &quot;</span>) + String(wheel_cmd_velocity_right_) +</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            String(<span class="stringliteral">&quot;\nWrite:\n&quot;</span>) +</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                String(<span class="stringliteral">&quot;motor_cmd_left_: &quot;</span>) + String(motor_cmd_left_) +</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                String(<span class="stringliteral">&quot;\nmotor_cmd_right_: &quot;</span>) + String(motor_cmd_right_) +</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                String(<span class="stringliteral">&quot;\npid_left_errors (p, i, d): &quot;</span>) + String(motor_pid_left_.proportional()) + String(<span class="stringliteral">&quot; &quot;</span>) + String(motor_pid_left_.integral()) + String(<span class="stringliteral">&quot; &quot;</span>) + String(motor_pid_left_.derivative()) +</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                String(<span class="stringliteral">&quot;\npid_right_error (p, i, d): &quot;</span>) + String(motor_pid_right_.proportional()) + String(<span class="stringliteral">&quot; &quot;</span>) + String(motor_pid_right_.integral()) + String(<span class="stringliteral">&quot; &quot;</span>) + String(motor_pid_right_.derivative());</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    nh_.loginfo(log_msg.c_str());</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;}</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#endif // DIFFBOT_BASE_CONTROLLER_H</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="adiffbot__base__config_8h_html"><div class="ttname"><a href="diffbot__base__config_8h.html">diffbot_base_config.h</a></div></div>
<div class="ttc" id="anamespacediffbot_html"><div class="ttname"><a href="namespacediffbot.html">diffbot</a></div><div class="ttdef"><b>Definition:</b> base_controller.h:23</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_a30323dd51be901ca398e2de5f3cec717"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a30323dd51be901ca398e2de5f3cec717">diffbot::BaseController::UpdateRate::control_</a></div><div class="ttdeci">double control_</div><div class="ttdef"><b>Definition:</b> base_controller.h:106</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_aac89c2d5c22bdabd9d697dad9a72babb"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#aac89c2d5c22bdabd9d697dad9a72babb">diffbot::BaseController::read</a></div><div class="ttdeci">void read()</div><div class="ttdoc">Reads the current encoder tick counts and joint states (angular position (rad) and angular velocity (...</div><div class="ttdef"><b>Definition:</b> base_controller.h:511</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a391fa1e490bd712720989b58fa0d9904"><div class="ttname"><a href="diffbot__base__config_8h.html#a391fa1e490bd712720989b58fa0d9904">PWM_MAX</a></div><div class="ttdeci">#define PWM_MAX</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:33</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1PID_html_a9589054b637d533a252f0fcae026c3d1"><div class="ttname"><a href="classdiffbot__msgs_1_1PID.html#a9589054b637d533a252f0fcae026c3d1">diffbot_msgs::PID::ki</a></div><div class="ttdeci">_ki_type ki</div><div class="ttdef"><b>Definition:</b> PID.h:18</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_ae560358977b6788dcbf345122f66a53f"><div class="ttname"><a href="diffbot__base__config_8h.html#ae560358977b6788dcbf345122f66a53f">ENCODER_RIGHT_H1</a></div><div class="ttdeci">#define ENCODER_RIGHT_H1</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:10</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1WheelsCmdStamped_html"><div class="ttname"><a href="classdiffbot__msgs_1_1WheelsCmdStamped.html">diffbot_msgs::WheelsCmdStamped</a></div><div class="ttdef"><b>Definition:</b> WheelsCmdStamped.h:14</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_acfc98b8c69707c30ac9a96bb12f2a0ab"><div class="ttname"><a href="diffbot__base__config_8h.html#acfc98b8c69707c30ac9a96bb12f2a0ab">K_P</a></div><div class="ttdeci">#define K_P</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:18</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_a096966d88bdf8ee1b5d82b4a055765a3"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a096966d88bdf8ee1b5d82b4a055765a3">diffbot::BaseController::UpdateRate::period</a></div><div class="ttdeci">Period &amp; period()</div><div class="ttdef"><b>Definition:</b> base_controller.h:126</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a6c8407098d2de3bf7b5b2d8a97293203"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a6c8407098d2de3bf7b5b2d8a97293203">diffbot::BaseController::setup</a></div><div class="ttdeci">void setup()</div><div class="ttdoc">Initializes the main node handle and setup publisher and subscriber.</div><div class="ttdef"><b>Definition:</b> base_controller.h:406</div></div>
<div class="ttc" id="astructdiffbot_1_1JointState_html"><div class="ttname"><a href="structdiffbot_1_1JointState.html">diffbot::JointState</a></div><div class="ttdef"><b>Definition:</b> encoder_diffbot.h:15</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a8cdc17f43c9f3850f60d04f98216fc13"><div class="ttname"><a href="diffbot__base__config_8h.html#a8cdc17f43c9f3850f60d04f98216fc13">ENCODER_RESOLUTION</a></div><div class="ttdeci">#define ENCODER_RESOLUTION</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:8</div></div>
<div class="ttc" id="aWheelsCmdStamped_8h_html"><div class="ttname"><a href="WheelsCmdStamped_8h.html">WheelsCmdStamped.h</a></div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1WheelsCmd_html_ac9126a9abe092db908d1987f6ae0b11b"><div class="ttname"><a href="classdiffbot__msgs_1_1WheelsCmd.html#ac9126a9abe092db908d1987f6ae0b11b">diffbot_msgs::WheelsCmd::angular_velocities</a></div><div class="ttdeci">_angular_velocities_type angular_velocities</div><div class="ttdef"><b>Definition:</b> WheelsCmd.h:17</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html_a7a8f48dde436f62fc40b6698a5bb0167"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a7a8f48dde436f62fc40b6698a5bb0167">diffbot::BaseController::LastUpdateTime::debug</a></div><div class="ttdeci">ros::Time debug</div><div class="ttdef"><b>Definition:</b> base_controller.h:176</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_ad51b9b4efeff34df5fb421b536e0ca47"><div class="ttname"><a href="diffbot__base__config_8h.html#ad51b9b4efeff34df5fb421b536e0ca47">UPDATE_RATE_IMU</a></div><div class="ttdeci">#define UPDATE_RATE_IMU</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:26</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1EncodersStamped_html"><div class="ttname"><a href="classdiffbot__msgs_1_1EncodersStamped.html">diffbot_msgs::EncodersStamped</a></div><div class="ttdef"><b>Definition:</b> EncodersStamped.h:14</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a9add57ee869347d4ee2eeb4e733539fd"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a9add57ee869347d4ee2eeb4e733539fd">diffbot::BaseController::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">Reads parameters from the parameter server.</div><div class="ttdef"><b>Definition:</b> base_controller.h:435</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a41354b4d51fc8fb9c97aca6d0d14a446"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a41354b4d51fc8fb9c97aca6d0d14a446">diffbot::BaseController::eStop</a></div><div class="ttdeci">void eStop()</div><div class="ttdoc">Stops the motors, in case no wheel commands are received over a longer time period.</div><div class="ttdef"><b>Definition:</b> base_controller.h:558</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a4f7d31f06ff280776657b53c771dc402"><div class="ttname"><a href="diffbot__base__config_8h.html#a4f7d31f06ff280776657b53c771dc402">ENCODER_LEFT_H2</a></div><div class="ttdeci">#define ENCODER_LEFT_H2</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:5</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a3148c286aedfd72fc73b730de3b7f8a6"><div class="ttname"><a href="diffbot__base__config_8h.html#a3148c286aedfd72fc73b730de3b7f8a6">ENCODER_LEFT_H1</a></div><div class="ttdeci">#define ENCODER_LEFT_H1</div><div class="ttdoc">Encoder pins.</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:4</div></div>
<div class="ttc" id="amain_8cpp_html_a4f09664c28604c52bef0b6974e62d1a9"><div class="ttname"><a href="main_8cpp.html#a4f09664c28604c52bef0b6974e62d1a9">motor_controller_left</a></div><div class="ttdeci">AdafruitMotorController motor_controller_left</div><div class="ttdef"><b>Definition:</b> main.cpp:13</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html">diffbot::BaseController::UpdateRate</a></div><div class="ttdoc">Stores update rate frequencies (Hz) for the main control loop, (optinal) imu and debug output.</div><div class="ttdef"><b>Definition:</b> base_controller.h:103</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a0dad88e3a39fd4a5cfa83eef522fa948"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a0dad88e3a39fd4a5cfa83eef522fa948">diffbot::BaseController::update_rate_</a></div><div class="ttdeci">struct diffbot::BaseController::UpdateRate update_rate_</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a7462df31aa9a7ad3e49fd7e15736dad9"><div class="ttname"><a href="diffbot__base__config_8h.html#a7462df31aa9a7ad3e49fd7e15736dad9">ENCODER_RIGHT_H2</a></div><div class="ttdeci">#define ENCODER_RIGHT_H2</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:11</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_ac039904aa4bbdb3aaf33277bf4877b82"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac039904aa4bbdb3aaf33277bf4877b82">diffbot::BaseController::UpdateRate::debug_</a></div><div class="ttdeci">double debug_</div><div class="ttdef"><b>Definition:</b> base_controller.h:107</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1PIDStamped_html_a00d5f430ae5ddc40f7549a4bb7ace2b4"><div class="ttname"><a href="classdiffbot__msgs_1_1PIDStamped.html#a00d5f430ae5ddc40f7549a4bb7ace2b4">diffbot_msgs::PIDStamped::pid</a></div><div class="ttdeci">_pid_type pid</div><div class="ttdef"><b>Definition:</b> PIDStamped.h:20</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_a693ab4729a3c580f79368f9d1d28b37e"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#a693ab4729a3c580f79368f9d1d28b37e">diffbot::BaseController::UpdateRate::period_</a></div><div class="ttdeci">struct diffbot::BaseController::UpdateRate::Period period_</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a23ae7d9ca0750e9b48b3b037556697a6"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a23ae7d9ca0750e9b48b3b037556697a6">diffbot::BaseController::commandCallback</a></div><div class="ttdeci">void commandCallback(const diffbot_msgs::WheelsCmdStamped &amp;cmd_msg)</div><div class="ttdoc">Callback method when a new diffbot_msgs::WheelsCmdStamped is received on the wheel_cmd_velocities top...</div><div class="ttdef"><b>Definition:</b> base_controller.h:465</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a1387b4e876fabe7bee2651f7bde4056e"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a1387b4e876fabe7bee2651f7bde4056e">diffbot::BaseController::last_update_time_</a></div><div class="ttdeci">struct diffbot::BaseController::LastUpdateTime last_update_time_</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_ac0ec145b57b867163cddab200b070576"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ac0ec145b57b867163cddab200b070576">diffbot::BaseController::UpdateRate::UpdateRate</a></div><div class="ttdeci">UpdateRate(double imu_frequency, double control_frequency, double debug_frequency)</div><div class="ttdoc">Construct a new Update Rate object.</div><div class="ttdef"><b>Definition:</b> base_controller.h:139</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a0b9e481775b5a7ecdd0dbb43cacc1a09"><div class="ttname"><a href="diffbot__base__config_8h.html#a0b9e481775b5a7ecdd0dbb43cacc1a09">K_D</a></div><div class="ttdeci">#define K_D</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:20</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html"><div class="ttname"><a href="classdiffbot_1_1BaseController.html">diffbot::BaseController</a></div><div class="ttdoc">Communicates with the high level hardware_interface::RobotHW and interacts with the robot hardware se...</div><div class="ttdef"><b>Definition:</b> base_controller.h:77</div></div>
<div class="ttc" id="aadafruit__feather__wing_8h_html"><div class="ttname"><a href="adafruit__feather__wing_8h.html">adafruit_feather_wing.h</a></div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html">diffbot::BaseController::LastUpdateTime</a></div><div class="ttdoc">Keeps track of the last update times.</div><div class="ttdef"><b>Definition:</b> base_controller.h:167</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a396de065f1958ceada2110f266ad41d2"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a396de065f1958ceada2110f266ad41d2">diffbot::BaseController::debug</a></div><div class="ttdeci">bool debug()</div><div class="ttdoc">Getter if the firmware should log debug output.</div><div class="ttdef"><b>Definition:</b> base_controller.h:211</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html_acf4ae0e5dc8af245bbec62161d71d7ba"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#acf4ae0e5dc8af245bbec62161d71d7ba">diffbot::BaseController::LastUpdateTime::imu</a></div><div class="ttdeci">ros::Time imu</div><div class="ttdef"><b>Definition:</b> base_controller.h:174</div></div>
<div class="ttc" id="aEncodersStamped_8h_html"><div class="ttname"><a href="EncodersStamped_8h.html">EncodersStamped.h</a></div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html_a315c93513da94a16a851685704014861"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a315c93513da94a16a851685704014861">diffbot::BaseController::LastUpdateTime::command_received</a></div><div class="ttdeci">ros::Time command_received</div><div class="ttdef"><b>Definition:</b> base_controller.h:170</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a4c57157c3165940f194e85be6aea09a9"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a4c57157c3165940f194e85be6aea09a9">diffbot::BaseController::BaseController</a></div><div class="ttdeci">BaseController(ros::NodeHandle &amp;nh, TMotorController *motor_controller_left, TMotorController *motor_controller_right)</div><div class="ttdoc">Construct a new Base Controller object using two generic motor controllers.</div><div class="ttdef"><b>Definition:</b> base_controller.h:385</div></div>
<div class="ttc" id="amain_8cpp_html_a8c8f15207982b3e185f86e1b4968e70d"><div class="ttname"><a href="main_8cpp.html#a8c8f15207982b3e185f86e1b4968e70d">nh</a></div><div class="ttdeci">ros::NodeHandle nh</div><div class="ttdef"><b>Definition:</b> main.cpp:8</div></div>
<div class="ttc" id="aAngularVelocities_8h_html"><div class="ttname"><a href="AngularVelocities_8h.html">AngularVelocities.h</a></div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_1_1Period_html_a41d2ff3999de2b4eb2f2c944d204e80c"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a41d2ff3999de2b4eb2f2c944d204e80c">diffbot::BaseController::UpdateRate::Period::debug_</a></div><div class="ttdeci">double debug_</div><div class="ttdef"><b>Definition:</b> base_controller.h:118</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_a5e606c8dc6de900bea3cd7740ac1bd4d"><div class="ttname"><a href="diffbot__base__config_8h.html#a5e606c8dc6de900bea3cd7740ac1bd4d">K_I</a></div><div class="ttdeci">#define K_I</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:19</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a001efa473375bc84721d4a4becae6250"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a001efa473375bc84721d4a4becae6250">diffbot::BaseController::pidLeftCallback</a></div><div class="ttdeci">void pidLeftCallback(const diffbot_msgs::PIDStamped &amp;pid_msg)</div><div class="ttdoc">Callback method to update the PID constants for the left motor.</div><div class="ttdef"><b>Definition:</b> base_controller.h:490</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1WheelsCmdStamped_html_ab136dcb1d1fb273b9c80d87394bb67bc"><div class="ttname"><a href="classdiffbot__msgs_1_1WheelsCmdStamped.html#ab136dcb1d1fb273b9c80d87394bb67bc">diffbot_msgs::WheelsCmdStamped::wheels_cmd</a></div><div class="ttdeci">_wheels_cmd_type wheels_cmd</div><div class="ttdef"><b>Definition:</b> WheelsCmdStamped.h:20</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a7dd1945472f83a891dc294daf76b4f47"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a7dd1945472f83a891dc294daf76b4f47">diffbot::BaseController::lastUpdateTime</a></div><div class="ttdeci">LastUpdateTime &amp; lastUpdateTime()</div><div class="ttdoc">Returns a reference to last_update_times_.</div><div class="ttdef"><b>Definition:</b> base_controller.h:202</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_aa54bf325fba5e78de32d34568279bce7"><div class="ttname"><a href="diffbot__base__config_8h.html#aa54bf325fba5e78de32d34568279bce7">UPDATE_RATE_CONTROL</a></div><div class="ttdeci">#define UPDATE_RATE_CONTROL</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:25</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a4c68e722a31b072408c54be82f3c6157"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a4c68e722a31b072408c54be82f3c6157">diffbot::BaseController::pidRightCallback</a></div><div class="ttdeci">void pidRightCallback(const diffbot_msgs::PIDStamped &amp;pid_msg)</div><div class="ttdoc">Callback method to update the PID constants for the right motor.</div><div class="ttdef"><b>Definition:</b> base_controller.h:500</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_af5d5dfd7526ef090dfce4d2dbf716fcb"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#af5d5dfd7526ef090dfce4d2dbf716fcb">diffbot::BaseController::period</a></div><div class="ttdeci">int period(double frequency)</div><div class="ttdoc">Calculates the period (s) from a given frequency (Hz).</div><div class="ttdef"><b>Definition:</b> base_controller.h:154</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_html_ad2078bf4193de947e61bb461845065ba"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate.html#ad2078bf4193de947e61bb461845065ba">diffbot::BaseController::UpdateRate::imu_</a></div><div class="ttdeci">double imu_</div><div class="ttdef"><b>Definition:</b> base_controller.h:105</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1AngularVelocities_html_a8062f7bed2e6ad9a9ed1b7d0ee1fafe7"><div class="ttname"><a href="classdiffbot__msgs_1_1AngularVelocities.html#a8062f7bed2e6ad9a9ed1b7d0ee1fafe7">diffbot_msgs::AngularVelocities::joint</a></div><div class="ttdeci">_joint_type * joint</div><div class="ttdef"><b>Definition:</b> AngularVelocities.h:18</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a963c3507de5449f9d4a8451a7a864e5b"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a963c3507de5449f9d4a8451a7a864e5b">diffbot::BaseController::publishRate</a></div><div class="ttdeci">UpdateRate &amp; publishRate()</div><div class="ttdef"><b>Definition:</b> base_controller.h:156</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_1_1Period_html_a126adae7a39d5a8f4b1bc52232832da6"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a126adae7a39d5a8f4b1bc52232832da6">diffbot::BaseController::UpdateRate::Period::imu_</a></div><div class="ttdeci">double imu_</div><div class="ttdef"><b>Definition:</b> base_controller.h:116</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a149626e3e16552903f8b53e5c37a0d86"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a149626e3e16552903f8b53e5c37a0d86">diffbot::BaseController::printDebug</a></div><div class="ttdeci">void printDebug()</div><div class="ttdef"><b>Definition:</b> base_controller.h:565</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html_aaa05a5efb43e892c1bc1614344cce952"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#aaa05a5efb43e892c1bc1614344cce952">diffbot::BaseController::LastUpdateTime::LastUpdateTime</a></div><div class="ttdeci">LastUpdateTime(ros::Time start)</div><div class="ttdoc">Construct a new Last Update Time object.</div><div class="ttdef"><b>Definition:</b> base_controller.h:186</div></div>
<div class="ttc" id="aclassdiffbot_1_1Encoder_html"><div class="ttname"><a href="classdiffbot_1_1Encoder.html">diffbot::Encoder</a></div><div class="ttdoc">Decorates the Teensy Encoder Library to read the angular wheel velocity from quadrature wheel encoder...</div><div class="ttdef"><b>Definition:</b> encoder_diffbot.h:35</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1PID_html_a909a4bf13dbfa8fa2617b247fac9ebaf"><div class="ttname"><a href="classdiffbot__msgs_1_1PID.html#a909a4bf13dbfa8fa2617b247fac9ebaf">diffbot_msgs::PID::kp</a></div><div class="ttdeci">_kp_type kp</div><div class="ttdef"><b>Definition:</b> PID.h:16</div></div>
<div class="ttc" id="adiffbot__base__config_8h_html_ab9e2ca73fb264cfb39a4790b614ba4cf"><div class="ttname"><a href="diffbot__base__config_8h.html#ab9e2ca73fb264cfb39a4790b614ba4cf">UPDATE_RATE_DEBUG</a></div><div class="ttdeci">#define UPDATE_RATE_DEBUG</div><div class="ttdef"><b>Definition:</b> diffbot_base_config.h:27</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1PID_html_a4aa5a80b7c77a1a412320e745b476b78"><div class="ttname"><a href="classdiffbot__msgs_1_1PID.html#a4aa5a80b7c77a1a412320e745b476b78">diffbot_msgs::PID::kd</a></div><div class="ttdeci">_kd_type kd</div><div class="ttdef"><b>Definition:</b> PID.h:20</div></div>
<div class="ttc" id="aclassdiffbot_1_1PID_html"><div class="ttname"><a href="classdiffbot_1_1PID.html">diffbot::PID</a></div><div class="ttdef"><b>Definition:</b> pid.h:6</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_1_1Period_html_a8a64d2fe88a5f6c955f2a48f4786106e"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a8a64d2fe88a5f6c955f2a48f4786106e">diffbot::BaseController::UpdateRate::Period::control_</a></div><div class="ttdeci">double control_</div><div class="ttdef"><b>Definition:</b> base_controller.h:117</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_1_1Period_html_a4cf807484d0d55818d3fdd798456741b"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html#a4cf807484d0d55818d3fdd798456741b">diffbot::BaseController::UpdateRate::Period::Period</a></div><div class="ttdeci">Period(double imu_frequency, double control_frequency, double debug_frequency)</div><div class="ttdef"><b>Definition:</b> base_controller.h:120</div></div>
<div class="ttc" id="aclassdiffbot__msgs_1_1PIDStamped_html"><div class="ttname"><a href="classdiffbot__msgs_1_1PIDStamped.html">diffbot_msgs::PIDStamped</a></div><div class="ttdef"><b>Definition:</b> PIDStamped.h:14</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1LastUpdateTime_html_a16aa742c7b6e982e0919fa1631104047"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1LastUpdateTime.html#a16aa742c7b6e982e0919fa1631104047">diffbot::BaseController::LastUpdateTime::control</a></div><div class="ttdeci">ros::Time control</div><div class="ttdef"><b>Definition:</b> base_controller.h:172</div></div>
<div class="ttc" id="amain_8cpp_html_ac36c3751c4beb4c6f24b01eb38332bd8"><div class="ttname"><a href="main_8cpp.html#ac36c3751c4beb4c6f24b01eb38332bd8">motor_controller_right</a></div><div class="ttdeci">AdafruitMotorController motor_controller_right</div><div class="ttdef"><b>Definition:</b> main.cpp:12</div></div>
<div class="ttc" id="astructdiffbot_1_1BaseController_1_1UpdateRate_1_1Period_html"><div class="ttname"><a href="structdiffbot_1_1BaseController_1_1UpdateRate_1_1Period.html">diffbot::BaseController::UpdateRate::Period</a></div><div class="ttdoc">Inverse of the update rates for control, (optional) imu and debug output.</div><div class="ttdef"><b>Definition:</b> base_controller.h:114</div></div>
<div class="ttc" id="aclassdiffbot_1_1MotorControllerIntf_html"><div class="ttname"><a href="classdiffbot_1_1MotorControllerIntf.html">diffbot::MotorControllerIntf</a></div><div class="ttdoc">Abstract base interface class for a motor controller.</div><div class="ttdef"><b>Definition:</b> motor_controller_interface.h:17</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a0d178440f5f9ca53ee9a07557db75ffd"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a0d178440f5f9ca53ee9a07557db75ffd">diffbot::BaseController::write</a></div><div class="ttdeci">void write()</div><div class="ttdoc">Uses the PIDs to compute capped PWM signals for the left and right motor.</div><div class="ttdef"><b>Definition:</b> base_controller.h:536</div></div>
<div class="ttc" id="aclassdiffbot_1_1BaseController_html_a9ee08db827f2d8b355ed5592bda44159"><div class="ttname"><a href="classdiffbot_1_1BaseController.html#a9ee08db827f2d8b355ed5592bda44159">diffbot::BaseController::resetEncodersCallback</a></div><div class="ttdeci">void resetEncodersCallback(const std_msgs::Empty &amp;reset_msg)</div><div class="ttdoc">Callback method to reset both encoder's tick count to zero.</div><div class="ttdef"><b>Definition:</b> base_controller.h:480</div></div>
<div class="ttc" id="aencoder__diffbot_8h_html"><div class="ttname"><a href="encoder__diffbot_8h.html">encoder_diffbot.h</a></div></div>
<div class="ttc" id="aPIDStamped_8h_html"><div class="ttname"><a href="PIDStamped_8h.html">PIDStamped.h</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
